<!DOCTYPE html>

<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We" crossorigin="anonymous">

    <link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon/favicon-16x16.png">
    <link rel="manifest" href="favicon/site.webmanifest">

    <title>{{ .Name }}</title>
    <base href="{{ .Path }}/" />

    <script>
        function makeRow(container, date, games) {
            var row = document.createElement("tr")

            var header = document.createElement("th")
            header.setAttribute("scope", "row")
            header.append(date.toLocaleDateString("en-US"))
            row.append(header)

            games.forEach(game => {
                makeCard(row, game)
            })

            container.append(row)
        }

        function makeCard(container, game) {
            var card = document.createElement("div")
            card.className = "card"
            var cardHeader = document.createElement("div")
            cardHeader.className = "card-header"
            cardHeader.append(`${game.Team} (${game.Home ? "HOME" : "AWAY"}) vs ${game.Opponent}`)
            card.append(cardHeader)

            var cardBody = document.createElement("div")
            cardBody.className = "card-body"
            cardBody.append(`${new Date(game.Time).toLocaleTimeString()} @ ${game.Location}`)
            card.append(cardBody)
            var td = document.createElement("td")
            td.append(card)
            container.append(td)
        }
    </script>
</head>

<body>
    <div class="col-lg-12 mx-auto p-3 py-md-5">
        <header>
            <h1>{{ .Name }}</h1>
            <a href="teams.ics">subscribe to calendar</a>
        </header>
        <main>
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th scope="col">Date</th>
                        <th colspan="3">Games</th>
                    </tr>
                </thead>
                <tbody id="table-games">
                </tbody>
            </table>
        </main>
        <footer>
            Created for {{ .Name }}
        </footer>
    </div>

    <script>
        window.onload = () => {
            var games = document.getElementById("table-games");
            games.innerHTML = '';
            fetch("teams.json")
                .then(response => {
                    return response.json();
                })
                .then(jsondata => {
                    Object.entries(jsondata).sort((a, b) => new Date(a[0]) - new Date(b[0])).forEach(event => {
                        makeRow(games, new Date(event[0]), event[1])
                    })
                    return jsondata
                });
        }
    </script>
</body>

</html>